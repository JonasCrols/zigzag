<!DOCTYPE html>
<html  lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1"><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

      <title>Stages</title>
    
          <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
          <link rel="stylesheet" href="_static/theme.css " type="text/css" />
      
      <!-- sphinx script_files -->
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>

      
      <!-- bundled in js (rollup iife) -->
      <!-- <script src="_static/theme-vendors.js"></script> -->
      <script src="_static/theme.js" defer></script>
    
  <link rel="index" title="Index" href="genindex.html" />
  <link rel="search" title="Search" href="search.html" />
  <link rel="next" title="Hardware Architecture Definition" href="hardware.html" />
  <link rel="prev" title="Getting Started" href="getting-started.html" /> 
  </head>

  <body>
    <div id="app">
    <div class="theme-container" :class="pageClasses"><navbar @toggle-sidebar="toggleSidebar">
  <router-link to="index.html" class="home-link">
    
      <span class="site-name">zigzag</span>
    
  </router-link>

  <div class="links">
    <navlinks class="can-hide">



    </navlinks>
  </div>
</navbar>

      
      <div class="sidebar-mask" @click="toggleSidebar(false)">
      </div>
        <sidebar @toggle-sidebar="toggleSidebar">
          
          <navlinks>
            



            
          </navlinks><div id="searchbox" class="searchbox" role="search">
  <div class="caption"><span class="caption-text">Quick search</span>
    <div class="searchformwrapper">
      <form class="search" action="search.html" method="get">
        <input type="text" name="q" />
        <input type="submit" value="Search" />
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />
      </form>
    </div>
  </div>
</div><div class="sidebar-links" role="navigation" aria-label="main navigation">
  
    <div class="sidebar-group">
      <p class="caption">
        <span class="caption-text"><a href="index.html#welcome-to-zigzag-s-documentation">Contents:</a></span>
      </p>
      <ul class="current">
        
          <li class="toctree-l1 ">
            
              <a href="zigzag.html" class="reference internal ">Zigzag Framework</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="installation.html" class="reference internal ">Installation</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="getting-started.html" class="reference internal ">Getting Started</a>
            

            
          </li>

        
          <li class="toctree-l1 current">
            
              <a href="#" class="reference internal current">Stages</a>
            

            
              <ul>
                
                  <li class="toctree-l2"><a href="#introduction" class="reference internal">Introduction</a></li>
                
                  <li class="toctree-l2"><a href="#implemented-stages" class="reference internal">Implemented stages</a></li>
                
                  <li class="toctree-l2"><a href="#creating-your-own-stages" class="reference internal">Creating your own stages</a></li>
                
              </ul>
            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="hardware.html" class="reference internal ">Hardware Architecture Definition</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="mapping.html" class="reference internal ">Mapping</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="contribute.html" class="reference internal ">Contribute to this project</a>
            

            
          </li>

        
      </ul>
    </div>
  
</div>
        </sidebar>

      <page>
          <div class="body-header" role="navigation" aria-label="navigation">
  
  <ul class="breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
    
    <li>Stages</li>
  </ul>
  

  <ul class="page-nav">
  <li class="prev">
    <a href="getting-started.html"
       title="previous chapter">← Getting Started</a>
  </li>
  <li class="next">
    <a href="hardware.html"
       title="next chapter">Hardware Architecture Definition →</a>
  </li>
</ul>
  
</div>
<hr>
          <div class="content" role="main" v-pre>
            
  <section id="stages">
<h1>Stages<a class="headerlink" href="#stages" title="Permalink to this heading">¶</a></h1>
<p>This document explains the concept of stages within the zigzag framework. It details the different implemented stages and explains how to create your own.</p>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this heading">¶</a></h2>
<p>Stages within zigzag are used to modularly and easily adapt the functionality of the framework. The different stages and their sequence of execution determine the goal of running the framework. The sequence of stages the framework will run through are defined in the main file. An example as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mainstage</span> <span class="o">=</span> <span class="n">MainStage</span><span class="p">([</span>  <span class="c1"># Initializes the MainStage as entry point</span>
    <span class="n">ONNXModelParserStage</span><span class="p">,</span>  <span class="c1"># Parses the ONNX Model into the workload</span>
    <span class="n">AcceleratorParserStage</span><span class="p">,</span>  <span class="c1"># Parses the accelerator</span>
    <span class="n">SimpleSaveStage</span><span class="p">,</span>  <span class="c1"># Saves all received CMEs information to a json</span>
    <span class="n">WorkloadStage</span><span class="p">,</span>  <span class="c1"># Iterates through the different layers in the workload</span>
    <span class="n">SpatialMappingConversionStage</span><span class="p">,</span>  <span class="c1"># Generates multiple spatial mappings (SM)</span>
    <span class="n">MinimalLatencyStage</span><span class="p">,</span>  <span class="c1"># Reduces all CMEs, returning minimal latency one</span>
    <span class="n">LomaStage</span><span class="p">,</span>  <span class="c1"># Generates multiple temporal mappings (TM)</span>
    <span class="n">CostModelStage</span>  <span class="c1"># Evaluates generated SM and TM through cost model</span>
<span class="p">],</span>
    <span class="n">accelerator_path</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">accelerator</span><span class="p">,</span>  <span class="c1"># required by AcceleratorParserStage</span>
    <span class="n">onnx_model_path</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">model</span><span class="p">,</span>  <span class="c1"># required by ONNXModelParserStage</span>
    <span class="n">mapping_path</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">mapping</span><span class="p">,</span>  <span class="c1"># required by ONNXModelParserStage</span>
    <span class="n">dump_filename_pattern</span><span class="o">=</span><span class="s2">&quot;outputs/{datetime}.json&quot;</span><span class="p">,</span>  <span class="c1"># output file save pattern</span>
    <span class="n">loma_lpf_limit</span><span class="o">=</span><span class="mi">6</span>  <span class="c1"># required by LomaStage</span>
<span class="p">)</span>

<span class="c1"># Run the mainstage</span>
<span class="n">mainstage</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>You can think of stages similar to those in a pipelined system. The MainStage provides an entry point for the framework to start execution from. All stages save the provided first argument as the sequence of remaining stages, of which the first one will be called when running said stage. In our example, the <code class="docutils literal notranslate"><span class="pre">MainStage</span></code> will automatically call the <code class="docutils literal notranslate"><span class="pre">ONNXModelParserStage</span></code> with the remaining stages <code class="docutils literal notranslate"><span class="pre">[WorkloadStage,</span> <span class="pre">...]</span></code> as its first argument. The <code class="docutils literal notranslate"><span class="pre">ONNXModelParserStage</span></code> will then call the <code class="docutils literal notranslate"><span class="pre">AcceleratorParserStage</span></code>, and so on. Besides the sequence of stages, the remaining arguments of the MainStage initialization are arguments required by one or more of the later stages. For example, the <code class="docutils literal notranslate"><span class="pre">dump_filename_pattern</span></code> is an argument required by the <code class="docutils literal notranslate"><span class="pre">CompleteSaveStage</span></code>.</p>
<p>The sequence of stages in the example will parse the inputs. It then iterates through each layer in the parsed workload, and for each layer convers the user-provided spatial mapping (SM) to the framework’s internal SM representation in the <code class="docutils literal notranslate"><span class="pre">SpatialMappingConversionStage</span></code>. It generates multiple temporal mappings (TM), and each SM + TM combination is fed to the cost model for HW cost evaluation.</p>
<p>So far, we have only discussed the sequential calling of stages from first to last. The reverse also holds true: when the CostModelStage finishes processing a SM + TM conbimation, it yields a CostModelEvaluation (CME) object back up the chain of stages. Some stages will simply pass this CME further up the chain, while others manipulate what is passed back up the chain. The <code class="docutils literal notranslate"><span class="pre">MinimalLatencyStage</span></code> for example, receives all the CMEs from the multiple cost model invocations for different TMs, but only passes the CME with the lowest latency back up the chain across all TMs. As such, the <code class="docutils literal notranslate"><span class="pre">CompleteSaveStage</span></code> only receives the CME with the lowest latency, which it will save to a file with the <code class="docutils literal notranslate"><span class="pre">dump_filename_pattern</span></code> pattern.</p>
</section>
<section id="implemented-stages">
<h2>Implemented stages<a class="headerlink" href="#implemented-stages" title="Permalink to this heading">¶</a></h2>
</section>
<section id="creating-your-own-stages">
<h2>Creating your own stages<a class="headerlink" href="#creating-your-own-stages" title="Permalink to this heading">¶</a></h2>
<p>Let’s say you are not interested in saving the CME with minimal energy, but want to save based on another metric provided by the CME. You can easily create a custom stage. The easiest way is copying an existing stage class definition, and modifying it according to your intended behaviour. To guarantee correctness, following aspects have to be taken into account when creating a custom stage:</p>
<ul class="simple">
<li><p>aspect 1</p></li>
<li><p>aspect 2</p></li>
</ul>
</section>
</section>


          </div>
          <div class="page-nav">
            <div class="inner"><ul class="page-nav">
  <li class="prev">
    <a href="getting-started.html"
       title="previous chapter">← Getting Started</a>
  </li>
  <li class="next">
    <a href="hardware.html"
       title="next chapter">Hardware Architecture Definition →</a>
  </li>
</ul><div class="footer" role="contentinfo">
      &#169; Copyright 2022, Arne Symons.
    <br>
    Created using <a href="http://sphinx-doc.org/">Sphinx</a> 5.1.1 with <a href="https://github.com/schettino72/sphinx_press_theme">Press Theme</a> 0.8.0.
</div>
            </div>
          </div>
      </page>
    </div></div>
    
    
  </body>
</html>